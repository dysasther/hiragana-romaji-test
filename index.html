<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hiragana Trainer - Romaji Challenge</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        /* Estilos adicionales */
        .hiragana-char {
            font-size: 8rem; /* Tama√±o grande para la s√≠laba principal */
            font-weight: bold;
            display: block;
            margin-bottom: 20px;
            color: #0d6efd; /* Azul de Bootstrap */
        }
        .jumbotron {
            padding: 2rem 1rem;
            margin-bottom: 2rem;
            background-color: #e9ecef;
            border-radius: 0.3rem;
        }
    </style>
</head>
<body>

    <div class="container mt-5">
        <h1 class="text-center mb-4">üáØüáµ Hiragana Romaji Trainer</h1>
        <p class="text-center lead">Escribe el Romaji correcto para la s√≠laba que se muestra.</p>

        <div id="game-area" class="card shadow p-4 mb-4" style="background-color: #f8f9fa;">
            <div class="d-flex justify-content-center">
                <span id="current-hiragana" class="hiragana-char">...</span>
            </div>

            <form id="answer-form">
                <div class="input-group mb-3">
                    <input type="text" id="romaji-input" class="form-control form-control-lg text-center" placeholder="Introduce Romaji (ej: ka)" aria-label="Romaji input" required autofocus>
                </div>
                <div class="d-grid gap-2 d-md-flex justify-content-md-center">
                    <button type="submit" class="btn btn-primary btn-lg flex-fill">‚úîÔ∏è Enviar (Adivinar)</button>
                    <button type="button" id="skip-button" class="btn btn-secondary btn-lg flex-fill">ü§î No la s√© (Aprender)</button>
                </div>
            </form>

            <div id="feedback" class="mt-3 text-center"></div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card bg-success text-white">
                    <div class="card-header">Estad√≠sticas</div>
                    <div class="card-body">
                        <p class="card-text">Aciertos: <span id="correct-count" class="fw-bold">0</span></p>
                        <p class="card-text">Fallos: <span id="incorrect-count" class="fw-bold">0</span></p>
                        <p class="card-text">Total Vistas: <span id="total-count" class="fw-bold">0</span></p>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card bg-warning text-dark">
                    <div class="card-header">S√≠labas Pendientes (No Aprendidas)</div>
                    <div class="card-body">
                        <p class="card-text" id="pending-count">Total: 0</p>
                        <p class="card-text small" id="pending-list"></p>
                    </div>
                </div>
            </div>
        </div>

        <div id="results-area" class="jumbotron text-center bg-info text-white" style="display: none;">
            <h2>üéâ Pr√°ctica Terminada!</h2>
            <p class="lead">Resultados finales:</p>
            <p class="fs-4">Aciertos: <span id="final-correct">0</span> | Fallos: <span id="final-incorrect">0</span> | Pendientes: <span id="final-pending">0</span></p>
            <button id="restart-button" class="btn btn-dark btn-lg mt-3">üîÑ Reiniciar Pr√°ctica</button>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmc5s7/Uqny9zL1G4y8mB7t30S/bT0Y3vQ5zT1uQyv79pZ+z8P+h5w1gK2FfTj18L5KxO05bXU1K9nS3tT7" crossorigin="anonymous"></script>

    <script>
        // ---------------------------------------------------
        // L√≥gica JavaScript
        // ---------------------------------------------------

        // Objeto que contiene todas las s√≠labas de a-no
        const allHiragana = {
            'a': '„ÅÇ', 'i': '„ÅÑ', 'u': '„ÅÜ', 'e': '„Åà', 'o': '„Åä',
            'ka': '„Åã', 'ki': '„Åç', 'ku': '„Åè', 'ke': '„Åë', 'ko': '„Åì',
            'sa': '„Åï', 'shi': '„Åó', 'su': '„Åô', 'se': '„Åõ', 'so': '„Åù',
            'ta': '„Åü', 'chi': '„Å°', 'tsu': '„Å§', 'te': '„Å¶', 'to': '„Å®',
            'na': '„Å™', 'ni': '„Å´', 'nu': '„Å¨', 'ne': '„Å≠', 'no': '„ÅÆ'
        };

        // Arreglo de s√≠labas Romaji (claves del objeto)
        let romajiKeys = Object.keys(allHiragana);
        // Lista de las s√≠labas pendientes por adivinar
        let remainingSyllables = [...romajiKeys];

        // Contadores
        let correctCount = 0;
        let incorrectCount = 0;
        let pendingSyllables = [];
        let totalCount = 0;

        let currentRomaji = ''; // Romaji correcto de la s√≠laba actual

        // Elementos del DOM
        const hiraganaDisplay = document.getElementById('current-hiragana');
        const romajiInput = document.getElementById('romaji-input');
        const answerForm = document.getElementById('answer-form');
        const skipButton = document.getElementById('skip-button');
        const feedbackDisplay = document.getElementById('feedback');
        const gameArea = document.getElementById('game-area');
        const resultsArea = document.getElementById('results-area');
        const restartButton = document.getElementById('restart-button');

        // Elementos de estad√≠sticas
        const correctCounter = document.getElementById('correct-count');
        const incorrectCounter = document.getElementById('incorrect-count');
        const totalCounter = document.getElementById('total-count');
        const pendingCounter = document.getElementById('pending-count');
        const pendingList = document.getElementById('pending-list');

        /**
         * Selecciona y muestra una nueva s√≠laba aleatoria.
         */
        function nextSyllable() {
            if (remainingSyllables.length === 0) {
                // Si no quedan s√≠labas, terminamos el juego
                endGame();
                return;
            }

            // Seleccionar un √≠ndice aleatorio
            const randomIndex = Math.floor(Math.random() * remainingSyllables.length);
            
            // Obtener el Romaji (clave) y el Hiragana (valor)
            currentRomaji = remainingSyllables[randomIndex];
            const currentHiragana = allHiragana[currentRomaji];

            // Mostrar en pantalla
            hiraganaDisplay.textContent = currentHiragana;
            
            // Limpiar entrada y feedback
            romajiInput.value = '';
            feedbackDisplay.textContent = '';
            romajiInput.focus();
        }

        /**
         * Maneja el env√≠o del formulario para comprobar la respuesta.
         */
        function checkAnswer(event) {
            event.preventDefault(); // Evita el env√≠o tradicional del formulario

            const userAnswer = romajiInput.value.toLowerCase().trim();
            totalCount++;
            
            // Si la respuesta es correcta
            if (userAnswer === currentRomaji) {
                correctCount++;
                feedbackDisplay.className = 'mt-3 text-center alert alert-success';
                feedbackDisplay.textContent = '¬°Correcto! Es ' + currentRomaji.toUpperCase() + '.';
                
                // Eliminar la s√≠laba del listado restante
                remainingSyllables = remainingSyllables.filter(r => r !== currentRomaji);

            } else {
                // Si la respuesta es incorrecta
                incorrectCount++;
                feedbackDisplay.className = 'mt-3 text-center alert alert-danger';
                feedbackDisplay.textContent = '¬°Incorrecto! La respuesta correcta era: ' + currentRomaji.toUpperCase() + '.';
                
                // Mantiene la s√≠laba en el listado restante para que pueda volver a aparecer
            }

            // Actualizar estad√≠sticas inmediatamente
            updateStats();

            // Retraso para que el usuario pueda ver el feedback antes de la siguiente s√≠laba
            setTimeout(nextSyllable, 1000); 
        }

        /**
         * Mueve la s√≠laba actual a la lista de "No Aprendidas".
         */
        function handleSkip() {
            // Solo si no ha sido saltada o adivinada antes
            if (remainingSyllables.includes(currentRomaji) && !pendingSyllables.includes(currentRomaji)) {
                pendingSyllables.push(currentRomaji);
                feedbackDisplay.className = 'mt-3 text-center alert alert-warning';
                feedbackDisplay.textContent = `La s√≠laba ${allHiragana[currentRomaji]} (${currentRomaji.toUpperCase()}) se ha a√±adido a Pendientes.`;

                // Eliminar la s√≠laba del listado restante
                remainingSyllables = remainingSyllables.filter(r => r !== currentRomaji);
            } else if (remainingSyllables.includes(currentRomaji)) {
                // Si ya estaba en la lista de pendientes (pero no est√° en el juego, lo que no deber√≠a pasar con el filtro de arriba)
                feedbackDisplay.className = 'mt-3 text-center alert alert-info';
                feedbackDisplay.textContent = `La s√≠laba ${allHiragana[currentRomaji]} ya estaba en Pendientes.`;
            }
            
            totalCount++;
            updateStats();
            setTimeout(nextSyllable, 1000);
        }

        /**
         * Actualiza los contadores en la interfaz.
         */
        function updateStats() {
            correctCounter.textContent = correctCount;
            incorrectCounter.textContent = incorrectCount;
            totalCounter.textContent = totalCount;
            pendingCounter.textContent = `Total: ${pendingSyllables.length}`;
            pendingList.textContent = pendingSyllables.map(r => `${allHiragana[r]} (${r})`).join(', ');
        }

        /**
         * Termina el juego y muestra los resultados finales.
         */
        function endGame() {
            gameArea.style.display = 'none';
            resultsArea.style.display = 'block';
            
            document.getElementById('final-correct').textContent = correctCount;
            document.getElementById('final-incorrect').textContent = incorrectCount;
            document.getElementById('final-pending').textContent = pendingSyllables.length;
        }

        /**
         * Reinicia el estado del juego.
         */
        function restartGame() {
            correctCount = 0;
            incorrectCount = 0;
            pendingSyllables = [];
            totalCount = 0;
            remainingSyllables = [...romajiKeys]; // Recarga todas las s√≠labas

            gameArea.style.display = 'block';
            resultsArea.style.display = 'none';
            
            updateStats();
            nextSyllable();
        }

        // ---------------------------------------------------
        // Event Listeners
        // ---------------------------------------------------
        answerForm.addEventListener('submit', checkAnswer);
        skipButton.addEventListener('click', handleSkip);
        restartButton.addEventListener('click', restartGame);

        // ---------------------------------------------------
        // Inicializaci√≥n
        // ---------------------------------------------------
        document.addEventListener('DOMContentLoaded', () => {
            nextSyllable(); // Empieza el juego al cargar la p√°gina
        });

    </script>

</body>
</html>